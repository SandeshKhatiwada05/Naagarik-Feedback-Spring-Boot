<!DOCTYPE html>
<html lang="ne" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <title>Naagarik Feedback Portal | नागरिक प्रतिक्रिया पोर्टल</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari&family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    /* Sticky footer layout */
    html, body { height: 100%; }
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background-color: #f5f5f5;
      font-family: 'Roboto', 'Noto Sans Devanagari', sans-serif;
      color: #333;
      margin: 0;
    }

    /* Top header bar */
    .top-header {
      background-color: #003366;
      color: white;
      font-size: 0.9rem;
      padding: 5px 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      letter-spacing: 0.05em;
    }
    .top-header .right-links a {
      color: white;
      text-decoration: none;
      margin-left: 20px;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
    }
    .top-header .right-links a.active { color: #ffcc00; text-decoration: underline; }
    .top-header .right-links a:hover { text-decoration: underline; }

    /* Main header */
    header {
      background-color: #004080;
      padding: 15px 30px;
      box-shadow: 0 2px 5px rgb(0 0 0 / 0.1);
    }
    .header-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      gap: 20px;
    }
    .header-logo img {
      width: 60px;
      height: auto;
      border-radius: 5px;
      border: 1px solid white;
    }
    .header-texts { color: white; line-height: 1.2; }
    .header-texts h1 { margin: 0; font-size: 1.7rem; font-weight: 700; letter-spacing: 0.03em; }
    .header-texts h2 { margin: 0; font-size: 1rem; font-weight: 500; letter-spacing: 0.03em; }

    /* Navigation bar */
    nav {
      background-color: #0059b3;
      box-shadow: inset 0 -3px 5px rgb(0 0 0 / 0.1);
    }
    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      gap: 30px;
      padding: 12px 30px;
    }
    nav a {
      color: white;
      font-weight: 600;
      text-decoration: none;
      font-size: 1rem;
      padding-bottom: 5px;
      border-bottom: 3px solid transparent;
      transition: border-color 0.3s ease, color 0.3s ease;
      font-family: 'Noto Sans Devanagari', sans-serif;
    }
    nav a:hover, nav a.active {
      border-bottom: 3px solid #ffcc00;
      color: #ffcc00;
    }

    /* Split panorama side rails + form grid */
    .main-layout {
      display: grid;
      grid-template-columns: clamp(140px, 18vw, 280px) minmax(320px, 900px) clamp(140px, 18vw, 280px);
      gap: 18px;
      align-items: start;
      width: min(98vw, 1400px);
      margin: 30px auto 80px;
    }
    .side-rail {
      position: relative;
      overflow: hidden;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.12);
      background: linear-gradient(135deg, #dfe9f3 0%, #ffffff 100%);
      min-height: 400px; /* synced to form height by JS */
      isolation: isolate;
    }
    .side-rail::after {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
              linear-gradient(rgba(255,255,255,0.08) 1px, transparent 1px),
              linear-gradient(90deg, rgba(255,255,255,0.08) 1px, transparent 1px);
      background-size: 20px 20px, 20px 20px;
      pointer-events: none;
      z-index: 3;
    }
    .side-rail::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse at center, rgba(0,0,0,0.0) 40%, rgba(0,0,0,0.12) 100%);
      pointer-events: none;
      z-index: 2;
    }

    /* Each slide is a DIV with background image sized to 200% width.
       Left rail shows left half, right rail shows right half, making a complete panorama across both sides. */
    .rail-slide {
      position: absolute;
      inset: 0;
      opacity: 0;
      transition: opacity 0.9s ease-in-out;
      background-repeat: no-repeat;
      background-size: 200% 100%; /* show exactly half per rail */
      transform-origin: center;
    }
    .side-rail.left .rail-slide { background-position: left center; transform-origin: left center; }
    .side-rail.right .rail-slide { background-position: right center; transform-origin: right center; }
    .rail-slide.active {
      opacity: 1;
      z-index: 1;
      animation: kbZoom 6s ease-in-out both;
    }
    @keyframes kbZoom {
      0%   { transform: scale(1.02); }
      100% { transform: scale(1.08); }
    }
    @media (prefers-reduced-motion: reduce) {
      .rail-slide { transition: none; animation: none !important; }
    }

    .rail-credit {
      position: absolute;
      left: 10px;
      bottom: 10px;
      z-index: 4;
      background: rgba(0,0,0,0.45);
      color: #fff;
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 4px;
      backdrop-filter: blur(2px);
    }
    .rail-hint {
      position: absolute;
      right: 10px;
      top: 10px;
      z-index: 4;
      font-size: 11px;
      color: rgba(255,255,255,0.9);
      background: rgba(0,0,0,0.35);
      padding: 2px 6px;
      border-radius: 999px;
      user-select: none;
      pointer-events: none;
    }

    /* Form card */
    main.form-card {
      background: white;
      padding: 30px 40px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgb(0 0 0 / 0.1);
    }
    main h2 {
      margin-bottom: 20px;
      font-weight: 700;
      color: #004080;
      text-align: center;
    }

    /* Buttons */
    .btn-primary {
      background-color: #004085;
      border-color: #004085;
      font-weight: 600;
    }
    .btn-primary:hover { background-color: #002752; border-color: #002752; }
    .btn-secondary {
      background-color: #ffcc00;
      border-color: #ffcc00;
      color: #004080;
      font-weight: 600;
    }
    .btn-secondary:hover { background-color: #e6b800; border-color: #e6b800; color: #00264d; }
    .btn-success {
      background-color: #198754;
      border-color: #198754;
      font-weight: 600;
    }
    .btn-success:hover { background-color: #145c32; border-color: #145c32; }

    /* Help text and validation */
    .form-text { color: #666; text-align: right; }
    .is-invalid + .invalid-feedback { display: block; }

    /* Footer */
    footer {
      background-color: #004080;
      color: white;
      padding: 20px 30px;
      text-align: center;
      font-size: 0.95rem;
      letter-spacing: 0.05em;
      margin-top: auto;
    }

    /* Responsive */
    @media (max-width: 992px) {
      .main-layout {
        grid-template-columns: 1fr;
        width: min(95vw, 900px);
        gap: 12px;
      }
      .side-rail { display: none; }
      main.form-card { padding: 24px; }
    }
  </style>
</head>
<body>

<!-- Top header with language switch -->
<div class="top-header">
  <div class="left-text" id="topLabel">नेपाल सरकार</div>
  <div class="right-links">
    <a id="langNep" href="#" class="active" aria-label="Switch to Nepali">NEP</a>
    <a id="langEng" href="#" aria-label="Switch to English">ENG</a>
  </div>
</div>

<header>
  <div class="header-container">
    <div class="header-logo">
      <img src="/images/Nepal-Flag.png" alt="Nepal Flag" />
    </div>
    <div class="header-texts">
      <h1 id="hdrTitle">नागरिक प्रतिक्रिया पोर्टल</h1>
      <h2 id="hdrSubtitle">Singha Durbar, Kathmandu | सिंहदरबार, काठमाडौं</h2>
    </div>
  </div>
</header>

<nav>
  <div class="nav-container">
    <a href="index.html" id="navHome">गृह पृष्ठ</a>
    <a href="add-feedback.html" id="navAdd" class="active">प्रतिक्रिया थप्नुहोस्</a>
    <a href="feedback-list.html" id="navView">प्रतिक्रिया हेर्नुहोस्</a>
  </div>
</nav>

<!-- 3-column layout: Left slideshow half | Form | Right slideshow half -->
<div class="main-layout">
  <!-- Left panorama half -->
  <aside class="side-rail left" id="railLeft" aria-label="Scenic Nepal images left rail">
    <div class="rail-hint">Hover to pause</div>
    <div class="rail-credit" id="leftCredit"></div>
    <!-- slides injected by JS -->
  </aside>

  <!-- Form card (center) -->
  <main class="form-card">
    <h2 id="pageHeading">प्रतिक्रिया थप्नुहोस्</h2>

    <form id="feedbackForm" novalidate>
      <div class="mb-3">
        <label for="name" class="form-label" id="lblName">नाम</label>
        <input type="text" id="name" class="form-control" required />
        <div class="invalid-feedback" id="errName">कृपया नाम लेख्नुहोस्।</div>
      </div>

      <div class="mb-3">
        <label for="location" class="form-label" id="lblLocation">ठेगाना</label>
        <input type="text" id="location" class="form-control" required />
        <div class="invalid-feedback" id="errLocation">कृपया ठेगाना लेख्नुहोस्।</div>
      </div>

      <div class="mb-2">
        <label for="feedback" class="form-label" id="lblFeedback">प्रतिक्रिया</label>
        <textarea id="feedback" class="form-control" rows="4" maxlength="500" required></textarea>
        <div class="invalid-feedback" id="errFeedback">कृपया प्रतिक्रिया लेख्नुहोस्।</div>
        <div class="form-text" id="feedbackHelp">०/५००</div>
      </div>

      <div class="mt-3 text-center">
        <button type="submit" class="btn btn-success me-2" id="btnSubmit">पेश गर्नुहोस्</button>
        <a href="index.html" class="btn btn-secondary" id="btnBack">पछाडि</a>
      </div>
    </form>
  </main>

  <!-- Right panorama half -->
  <aside class="side-rail right" id="railRight" aria-label="Scenic Nepal images right rail">
    <div class="rail-hint">Hover to pause</div>
    <div class="rail-credit" id="rightCredit"></div>
    <!-- slides injected by JS -->
  </aside>
</div>

<footer id="footerText">
  &copy; 2025 नागरिक प्रतिक्रिया पोर्टल | Naagarik Feedback Portal. सबै अधिकार सुरक्षित | All Rights Reserved.
</footer>

<script>
  (function() {
    // Translations
    const t = {
      ne: {
        pageTitle: 'Naagarik Feedback Portal | नागरिक प्रतिक्रिया पोर्टल',
        topLabel: 'नेपाल सरकार',
        hdrTitle: 'नागरिक प्रतिक्रिया पोर्टल',
        hdrSubtitle: 'सिंहदरबार, काठमाडौं',
        navHome: 'गृह पृष्ठ',
        navAdd: 'प्रतिक्रिया थप्नुहोस्',
        navView: 'प्रतिक्रिया हेर्नुहोस्',
        pageHeading: 'प्रतिक्रिया थप्नुहोस्',
        lblName: 'नाम',
        lblLocation: 'ठेगाना',
        lblFeedback: 'प्रतिक्रिया',
        phName: 'तपाईंको पूरा नाम',
        phLocation: 'तपाईंको ठेगाना/स्थान',
        phFeedback: 'तपाईंको सुझाव वा गुनासा यहाँ लेख्नुहोस्...',
        errName: 'कृपया नाम लेख्नुहोस्।',
        errLocation: 'कृपया ठेगाना लेख्नुहोस्।',
        errFeedback: 'कृपया प्रतिक्रिया लेख्नुहोस्।',
        helpCounter: (cur, max) => `${cur}/${max}`,
        btnSubmit: 'पेश गर्नुहोस्',
        btnSubmitting: 'पेश गर्दै...',
        btnBack: 'पछाडि',
        toastSuccess: 'प्रतिक्रिया सफलतापूर्वक पेश भयो!',
        toastError: 'प्रतिक्रिया पेश गर्न समस्या आयो।',
        toastNetwork: 'नेटवर्क त्रुटि। कृपया पुन: प्रयास गर्नुहोस्।',
        footer: '© 2025 नागरिक प्रतिक्रिया पोर्टल | Naagarik Feedback Portal. सबै अधिकार सुरक्षित | All Rights Reserved.'
      },
      en: {
        pageTitle: 'Naagarik Feedback Portal | Citizen Feedback Portal',
        topLabel: 'Government of Nepal',
        hdrTitle: 'Naagarik Feedback Portal',
        hdrSubtitle: 'Singha Durbar, Kathmandu',
        navHome: 'Home',
        navAdd: 'Add Feedback',
        navView: 'View Feedback',
        pageHeading: 'Add Feedback',
        lblName: 'Name',
        lblLocation: 'Location',
        lblFeedback: 'Feedback',
        phName: 'Your full name',
        phLocation: 'Your address/location',
        phFeedback: 'Write your suggestion or grievance here...',
        errName: 'Please enter your name.',
        errLocation: 'Please enter your location.',
        errFeedback: 'Please enter your feedback.',
        helpCounter: (cur, max) => `${cur}/${max}`,
        btnSubmit: 'Submit',
        btnSubmitting: 'Submitting...',
        btnBack: 'Back',
        toastSuccess: 'Feedback submitted!',
        toastError: 'Error submitting feedback.',
        toastNetwork: 'Network error. Please try again.',
        footer: '© 2025 Naagarik Feedback Portal | Citizen Feedback Portal. All Rights Reserved.'
      }
    };

    const els = {
      langNep: document.getElementById('langNep'),
      langEng: document.getElementById('langEng'),
      topLabel: document.getElementById('topLabel'),
      hdrTitle: document.getElementById('hdrTitle'),
      hdrSubtitle: document.getElementById('hdrSubtitle'),
      navHome: document.getElementById('navHome'),
      navAdd: document.getElementById('navAdd'),
      navView: document.getElementById('navView'),
      pageHeading: document.getElementById('pageHeading'),
      lblName: document.getElementById('lblName'),
      lblLocation: document.getElementById('lblLocation'),
      lblFeedback: document.getElementById('lblFeedback'),
      name: document.getElementById('name'),
      location: document.getElementById('location'),
      feedback: document.getElementById('feedback'),
      errName: document.getElementById('errName'),
      errLocation: document.getElementById('errLocation'),
      errFeedback: document.getElementById('errFeedback'),
      feedbackHelp: document.getElementById('feedbackHelp'),
      btnSubmit: document.getElementById('btnSubmit'),
      btnBack: document.getElementById('btnBack'),
      footerText: document.getElementById('footerText'),
      form: document.getElementById('feedbackForm'),
      centerCard: document.querySelector('main.form-card'),
      railLeft: document.getElementById('railLeft'),
      railRight: document.getElementById('railRight'),
      leftCredit: document.getElementById('leftCredit'),
      rightCredit: document.getElementById('rightCredit')
    };

    const MAX = 500;
    let lang = 'ne';

    function applyLang(l) {
      lang = (l === 'en') ? 'en' : 'ne';
      const tr = t[lang];
      document.documentElement.lang = lang;
      document.title = tr.pageTitle;

      els.topLabel.textContent = tr.topLabel;
      els.hdrTitle.textContent = tr.hdrTitle;
      els.hdrSubtitle.textContent = tr.hdrSubtitle;

      els.navHome.textContent = tr.navHome;
      els.navAdd.textContent = tr.navAdd;
      els.navView.textContent = tr.navView;

      els.pageHeading.textContent = tr.pageHeading;

      els.lblName.textContent = tr.lblName;
      els.lblLocation.textContent = tr.lblLocation;
      els.lblFeedback.textContent = tr.lblFeedback;

      els.name.placeholder = tr.phName;
      els.location.placeholder = tr.phLocation;
      els.feedback.placeholder = tr.phFeedback;

      els.errName.textContent = tr.errName;
      els.errLocation.textContent = tr.errLocation;
      els.errFeedback.textContent = tr.errFeedback;

      const cur = els.feedback.value.length;
      els.feedbackHelp.textContent = tr.helpCounter(cur, MAX);

      els.btnSubmit.textContent = tr.btnSubmit;
      els.btnBack.textContent = tr.btnBack;

      els.footerText.textContent = tr.footer;

      els.langEng.classList.toggle('active', lang === 'en');
      els.langNep.classList.toggle('active', lang === 'ne');

      try { localStorage.setItem('siteLang', lang); } catch {}
    }

    function initLang() {
      try {
        const saved = localStorage.getItem('siteLang');
        if (saved === 'en' || saved === 'ne') lang = saved;
      } catch {}
      applyLang(lang);
    }

    els.langNep.addEventListener('click', (e) => { e.preventDefault(); applyLang('ne'); });
    els.langEng.addEventListener('click', (e) => { e.preventDefault(); applyLang('en'); });

    initLang();

    // Character counter
    function updateCounter() {
      const tr = t[lang];
      const len = els.feedback.value.length;
      els.feedbackHelp.textContent = tr.helpCounter(len, MAX);
    }
    els.feedback.addEventListener('input', updateCounter);

    // Basic validation + submit
    function setInvalid(el, invalid, msgEl) {
      if (invalid) {
        el.classList.add('is-invalid');
        if (msgEl) msgEl.style.display = 'block';
      } else {
        el.classList.remove('is-invalid');
        if (msgEl) msgEl.style.display = 'none';
      }
    }

    els.form.addEventListener('submit', function(e) {
      e.preventDefault();
      const tr = t[lang];

      const name = els.name.value.trim();
      const location = els.location.value.trim();
      const feedback = els.feedback.value.trim();

      let valid = true;
      setInvalid(els.name, !name, els.errName); if (!name) valid = false;
      setInvalid(els.location, !location, els.errLocation); if (!location) valid = false;
      setInvalid(els.feedback, !feedback, els.errFeedback); if (!feedback) valid = false;

      if (!valid) return;

      els.btnSubmit.disabled = true;
      const oldText = els.btnSubmit.textContent;
      els.btnSubmit.textContent = tr.btnSubmitting;

      fetch('/feedback/add-feedback', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, location, feedback })
      })
              .then(res => {
                if (!res.ok) throw new Error('bad_status');
                alert(tr.toastSuccess);
                window.location.href = 'feedback-list.html';
              })
              .catch(err => {
                console.error('Submit error:', err);
                alert(err.message === 'bad_status' ? tr.toastError : tr.toastNetwork);
                els.btnSubmit.disabled = false;
                els.btnSubmit.textContent = oldText;
              });
    });

    // Split panorama slideshow (left/right halves from the same image), 3s per image
    const imageUrls = [
      'https://images.travelandleisureasia.com/wp-content/uploads/sites/3/2023/12/29122131/pokhra-1-1600x900.jpeg',
      'https://www.gokitetours.com/wp-content/uploads/2024/12/10-Beautiful-Places-to-Visit-in-Nepal-on-Your-Next-Vacation.webp',
      'https://images.squarespace-cdn.com/content/v1/609d3f1781f4a87463f238cb/1692302796055-97BM3S7YLYKRR1DEI2DS/image-asset.jpeg',
      'https://media.nepalhighlandtreks.com/uploads/media/featured-2.jpg',
      'https://thumbs.dreamstime.com/b/mountain-lake-beautiful-sunset-gosaikunda-nepal-over-snow-covered-mountains-frozen-landscape-view-trekking-route-langtang-61315510.jpg',
      'https://basecampadventure.com/wp-content/uploads/2018/07/Kathmandu-Chitwan-Pokhara-Tours-IV-1290x540.jpg',
      'https://www.ambitionhimalaya.com/wp-content/uploads/2024/05/View-of-Nagarkot.webp'
    ];

    const prefersReducedMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    function hostName(u) {
      try { return new URL(u).hostname.replace(/^www\./,''); } catch { return ''; }
    }

    // Build paired slides (same index on left/right), each shows half via background-size: 200%
    const leftSlides = [], rightSlides = [];
    imageUrls.forEach((src, i) => {
      const l = document.createElement('div');
      l.className = 'rail-slide';
      l.style.backgroundImage = `url("${src}")`;
      els.railLeft.appendChild(l);
      leftSlides.push(l);

      const r = document.createElement('div');
      r.className = 'rail-slide';
      r.style.backgroundImage = `url("${src}")`;
      els.railRight.appendChild(r);
      rightSlides.push(r);

      const pre = new Image(); pre.src = src; // preload
    });

    let idx = 0;
    function setActive(i) {
      leftSlides[idx]?.classList.remove('active');
      rightSlides[idx]?.classList.remove('active');
      idx = (i + leftSlides.length) % leftSlides.length;
      leftSlides[idx].classList.add('active');
      rightSlides[idx].classList.add('active');
      els.leftCredit.textContent = 'Image: ' + hostName(imageUrls[idx]);
      els.rightCredit.textContent = 'Image: ' + hostName(imageUrls[idx]);
    }

    if (leftSlides.length) setActive(0);

    let timer = null;
    function start() {
      stop();
      if (!prefersReducedMotion && leftSlides.length > 1) {
        timer = setInterval(() => setActive(idx + 1), 3000);
      }
    }
    function stop() { if (timer) { clearInterval(timer); timer = null; } }

    els.railLeft.addEventListener('mouseenter', stop);
    els.railRight.addEventListener('mouseenter', stop);
    els.railLeft.addEventListener('mouseleave', start);
    els.railRight.addEventListener('mouseleave', start);
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) stop(); else start();
    });
    start();

    // Match rail heights to form for a clean edge-to-edge look
    function syncRailHeights() {
      const h = els.centerCard.offsetHeight;
      els.railLeft.style.height = h + 'px';
      els.railRight.style.height = h + 'px';
    }
    let rAF = null;
    function onResize() {
      if (rAF) cancelAnimationFrame(rAF);
      rAF = requestAnimationFrame(syncRailHeights);
    }
    window.addEventListener('load', syncRailHeights);
    window.addEventListener('resize', onResize);
  })();
</script>

</body>
</html>